<div class="card" id="card-electronic-signature">
    <div class="card-header">
        <h6>Electornic Siganture <small>without Verification</small></h6>
    </div>
    <div class="card-body">
        <h6 class="mb-4">Messages</h6>
        <textarea class="form-control form-control-sm" id="textarea-message" name="textarea-message"
            rows="4">특수문자: !@#$%^&*()_+{}|숫자: 1234567890한글: 하나에  가슴속에 새겨지는 그리고 피어나듯이 내린 봅니다. 영어: Lorem ipsum dolor sit amet, consectetur</textarea>
        <div class="d-none mt-4" id="detached-message">
            <label class="col-form-label" for="textarea-detached-message">Detached Message</label>
            <textarea class="form-control form-control-sm" id="textarea-detached-message"
                name="textarea-detached-message" placeholder="Detached Signature Message" rows="4"></textarea>
        </div>

        <h6 class="mt-4 mb-4">Signature Options</h6>
        <!-- row -->
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group row">
                    <label class="col-sm-4 col-form-label" for="select-signature-type">Signature Type</label>
                    <div class="col-sm-8">
                        <select class="form-control form-control-sm" id="select-signature-type"
                            name="select-signature-type" size="1">
                            <option value="p1sign">P1 sign</option>
                            <option selected value="p7sign">P7 sign</option>
                            <option value="envelop">Envelop</option>
                            <option value="signedAndEnvelop">Sign and envelop</option>
                            <option value="addSign">Add sign</option>
                            <option value="signDetached">Detached sign</option>
                            <option value="addSignDetached">Add detached signature</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group row">
                    <label class="col-sm-4 col-form-label" for="select-charset">Charset</label>
                    <div class="col-sm-8">
                        <select class="form-control form-control-sm" id="select-charset" name="select-charset" size="1">
                            <option selected value="utf8">UTF8</option>
                            <option value="euckr">EUC-KR</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.row-->

        <!-- row -->
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group row">
                    <label class="col-sm-4 col-form-label" for="select-encoding">Encoding</label>
                    <div class="col-sm-8">
                        <select class="form-control form-control-sm" id="select-encoding" name="select-encoding"
                            size="1">
                            <option selected value="base64"> BASE64</option>
                            <option value="hex">HEX</option>
                            <option value="pem">PEM</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group row">
                    <label class="col-sm-4 col-form-label" for="select-digest-algorithm">Diegset
                        Algorithm</label>
                    <div class="col-sm-8">
                        <select class="form-control form-control-sm" id="select-digest-algorithm"
                            name="select-digest-algorithm" size="1">
                            <option value="sha1">SHA1</option>
                            <option selected value="sha256">SHA256</option>
                            <option value="sha384">SHA384</option>
                            <option value="sha512">SHA512</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.row-->

        <!-- row -->
        <div class="row d-none" id="cipher-algorithm">
            <div class="col-sm-6">
                <div class="form-group row">
                    <label class="col-sm-4 col-form-label" for="select-cipher-algorithm">Cipher
                        Algorithm</label>
                    <div class="col-sm-8">
                        <select class="form-control form-control-sm" id="select-cipher-algorithm"
                            name="select-cipher-algorithm" size="1">
                            <option selected value="seedCBC">seedCBC</option>
                            <option value="aes128-CBC">aes128-CBC</option>
                            <option value="aes192-CBC">aes192-CBC</option>
                            <option value="aes256-CBC">aes256-CBC</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="row d-none" id="detached-option-wrapper">
            <div class="col-sm-6">
                <div class="form-group row">
                    <label class="col-sm-4 col-form-label" for="select-sign-attribute">Sign Attributes</label>
                    <div class="col-sm-8">
                        <select class="form-control form-control-sm" id="select-sign-attribute" size="1">
                            <option selected value="">None</option>
                            <option selected value="smimesignCertv2" checked>smimesignCertv2</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group row">
                    <label class="col-sm-4 col-form-label" for="hashed-content">Hashed Content</label>
                    <div class="col-sm-8">
                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="hashed-content" checked="">
                            <label class="custom-control-label" for="hashed-content"></label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- /.row-->
        <div class="d-none" id="envelop-key">
            <label for="textarea-cert">Certificate to Envelop <small>한정인(개인) signCert.der</small></label>
            <textarea class="form-control form-control-sm" id="textarea-cert" name="textarea-cert"
                rows="4">-----BEGIN CERTIFICATE-----MIIFyzCCBLOgAwIBAgIEBVo2TTANBgkqhkiG9w0BAQsFADBKMQswCQYDVQQGEwJLUjENMAsGA1UECgwES0lDQTEVMBMGA1UECwwMQWNjcmVkaXRlZENBMRUwEwYDVQQDDAxzaWduR0FURSBDQTUwHhcNMjAwNjE3MDAyMjEwWhcNMjEwNzA4MTQ1OTU5WjCBkjELMAkGA1UEBhMCS1IxDTALBgNVBAoMBEtJQ0ExEzARBgNVBAsMCmxpY2Vuc2VkQ0ExFTATBgNVBAsMDOuTseuhneq4sOq0gDEZMBcGA1UECwwQS0lDQeqzoOqwneyEvO2EsDERMA8GA1UECwwI7IS87YSwUkExGjAYBgNVBAMMEe2VnOygleyduCjqsJzsnbgpMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAhk4R6nSzx2X4Kt751CtXj5oQOunvKXhzrieivDXc5qQviLMR+w6IqXHC/Z6q1jOagdArH9AQmKnD/26Tnhgud9jDVDmBaUns61scQ4GBD6VpkBtVsPe439nXOmsGU3ZLgf31YQfECzBk8zroWCvrsFFQC4uR3tkV768GQm6OwBk38JMPjJpqyZLR0ZzQJqBcepkI5iqmD+rYsMkm4HmLZY618egGP6mGGTmy9/l7xFGS2RiwSb7vtMLY/U94PkOR5XtQwH/k6EKfoZRTItDoRqsZKHpo189+rQExeBAC+748QK+Y+Yom/yYJda5MJgw7w1k4RIfwr0iXKWWgp8mLjQIDAQABo4ICbjCCAmowgY8GA1UdIwSBhzCBhIAU2L467EWZxZ7jnOqBH9IdErA2PoihaKRmMGQxCzAJBgNVBAYTAktSMQ0wCwYDVQQKDARLSVNBMS4wLAYDVQQLDCVLb3JlYSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eSBDZW50cmFsMRYwFAYDVQQDDA1LSVNBIFJvb3RDQSA0ggIQHTAdBgNVHQ4EFgQU/0odTZLJLQDtHlB+IhMY3lRtzCMwDgYDVR0PAQH/BAQDAgbAMHUGA1UdIARuMGwwagYKKoMajJpEBQIBAjBcMCwGCCsGAQUFBwIBFiBodHRwOi8vd3d3LnNpZ25nYXRlLmNvbS9jcHMuaHRtbDAsBggrBgEFBQcCAjAgHh7HdAAgx3jJncEcspQAIKz1x3jHeMmdwRzHhbLIsuQwgYgGA1UdEQSBgDB+gRVwdXJlMjcxM0BzaWduZ2F0ZS5jb22gZQYJKoMajJpECgEBoFgwVgwR7ZWc7KCV7J24KOqwnOyduCkwQTA/BgoqgxqMmkQKAQEBMDEwCwYJYIZIAWUDBAIBoCIEIAD0qdxBiV9bf4u4z0VtZWhXZAvsZyLJVMIgOYESyjm6MF8GA1UdHwRYMFYwVKBSoFCGTmxkYXA6Ly9sZGFwLnNpZ25nYXRlLmNvbTozODkvb3U9ZHA3cDIyNzk5LG91PWNybGRwLG91PUFjY3JlZGl0ZWRDQSxvPUtJQ0EsYz1LUjBEBggrBgEFBQcBAQQ4MDYwNAYIKwYBBQUHMAGGKGh0dHA6Ly9vY3NwLnNpZ25nYXRlLmNvbTo5MDIwL09DU1BTZXJ2ZXIwDQYJKoZIhvcNAQELBQADggEBABrkL9RsgVGNRjX7CIUFULklx6IOAFaSIEZUZsxtX1l3w3thW0GUnt4hXvN7RD4pqVxAgxiVJaU/jRqTUTUIxgpOGPRpQzlR7cfbBotAZI7R9WesIaUV/gAucTMIv1qNBDn9Bd9S68A49raWE91zpMRLjkDqyjrL9MyFgQWsIFj06bxc7gj6lGO5XDEiFx5ISmDCEHuZjpP1oMl/mbOC4m1ktz2w6uIWY4y9fe9Znzi4OkT9KNUlZ7cXFBGC1ZW8QS0coEs+V4C0X2e27pJDKXDq/ioxy9/LWauNNNaBvowwt3BXb687zsunDn7XWqu6KKekeVgZU8fzJdI6cRjK/p4=-----END CERTIFICATE-----</textarea>
        </div>

        <button class="btn btn-sm btn-pill btn-block btn-primary mt-4" id="button-sign" type="button">Sign</button>

        <h6 class="mt-4 mb-4">Result</h6>
        <textarea class="form-control form-control-sm" id="textarea-sign-result" rows="6"
            placeholder="결과가 여기에 표시됩니다."></textarea>

    </div>
</div>

<script>
    var signatureMethod;
    $('#select-signature-type').change(function () {
        signatureMethod = $(this).val();
        $('#envelop-key, #detached-message, #cipher-algorithm, #detached-option-wrapper').addClass('d-none');

        if (["envelop", "signedAndEnvelop"].indexOf(signatureMethod) !== -1) {
            $('#envelop-key, #cipher-algorithm').removeClass('d-none');
        }
        else if (signatureMethod === "signDetached") {
            $('#detached-option-wrapper').removeClass('d-none');
        }
        else if (signatureMethod === "addSignDetached") {
            $('#detached-message').removeClass('d-none');
            $('#detached-option-wrapper').removeClass('d-none');
        }
    });

    function callback(result, error) {
        if (error)
            return;

        $('#textarea-sign-result').val(result);
        KICA_DIALOG.closeSelectCertificateDialog();
    }

    $('#button-sign').click(function () {
        signatureMethod = $('#select-signature-type').val();

        var message = $('#textarea-message').val();
        var options = {
            charset: $('#select-charset').val(),
            encoding: $('#select-encoding').val(),
            outputEncoding: $('#select-encoding').val()
        }

        var cert;
        if (signatureMethod !== "envelop")
            options.digestAlg = $('#select-digest-algorithm').val();

        if (["envelop", "signedAndEnvelop"].indexOf(signatureMethod) !== -1) {
            cert = $("#textarea-cert").val();
            options.cipherAlg = $('#select-cipher-algorithm').val();

        }

        switch (signatureMethod) {
            case "envelop":
                eval("html5Api." + signatureMethod + "(cert, message, options, callback)");
                break;
            case "signedAndEnvelop":
                eval("html5DialogApi." + signatureMethod + "(cert, message, options, callback)");
                break;
            case "addSignDetached":
                var detachedMessage = $('#textarea-detached-message').val();
                eval("html5DialogApi." + signatureMethod + "(detachedMessage, message, options, callback)");
                break;

            case "signDetached":                
                options.hashedContent = $("#hashed-content").prop('checked');;
                if(options.hashedContent)
                    message = webnpki.bin.decodeHex(message);

                options.authAttrs = [$("#select-sign-attribute").val()];
                eval("html5DialogApi." + + "(message, options, callback)");

            default:
                eval("html5DialogApi." + signatureMethod + "(message, options, callback)");
                break;
        }
    });
</script>