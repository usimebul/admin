<div class="card" id="card-electronic-signature">
    <div class="card-header"><strong>Block Cipher</strong></div>
    <div class="card-body">
        <div class="row">
            <div class="col-sm-2 ml-auto">
                <button class="btn btn-sm btn-pill btn-info btn-block" id="button-reset-key" type="button">Clear
                    key</button>
            </div>
        </div>
        <h6>Message </h6>
        <!-- row -->
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group row">
                    <label class="col-sm-4 col-form-label" for="textarea-message">Source String</label>
                    <div class="col-sm-8">
                        <textarea class="form-control form-control-sm" id="textarea-message" name="textarea-message"
                            rows="1">특수문자: !@#$%^&*()_+{}|숫자: 1234567890한글: 어: Lorem ipsum dolor sit amet, consectetur</textarea>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <div class="form-group row">
                    <label class="col-sm-4 col-form-label" for="text-file-path">File Path</label>
                    <div class="col-sm-8">
                        <input tpye="text" class="form-control form-control-sm" id="text-file-path"
                            value="S:/SecuKitNXS/test.txt">
                    </div>
                </div>
            </div>

            <h6 class="col-sm-12 mt-2 mb-2"> Cipher Options </h6>

            <div class="col-sm-6">
                <div class="form-group row">
                    <label class="col-sm-4 col-form-label" for="select-cipher-algorithm">Cipher
                        Algorithm</label>
                    <div class="col-sm-8">
                        <select class="form-control form-control-sm" id="select-cipher-algorithm"
                            name="select-cipher-algorithm" size="1">
                            <option selected value="SEED">SEED</option>
                            <option value="AES">AES</option>
                            <option value="DES">DES</option>
                            <option value="3DES">3DES</option>
                            <option value="ARIA128">ARIA128</option>
                            <option value="RC4">RC4</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group row">
                    <label class="col-sm-4 col-form-label" for="select-cipher-mode">Mode</label>
                    <div class="col-sm-8">
                        <select class="form-control form-control-sm" id="select-cipher-mode" name="select-cipher-mode"
                            size="1">
                            <option selected value="CBC">CBC</option>
                            <option value="ECB">ECB</option>
                            <option value="CFB">CFB</option>
                            <option value="OFB">OFB</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group row">
                    <label class="col-sm-4 col-form-label" for="select-cipher-padding">Padding</label>
                    <div class="col-sm-8">
                        <select class="form-control form-control-sm" id="select-cipher-padding" size="1">
                            <option selected value="PADDING">PADDING</option>
                            <option value="NOPADDING">NOPADDING</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group row">
                    <label class="col-sm-4 col-form-label" for="text-iv">IV</label>
                    <div class="col-sm-6">
                        <input class="form-control form-control-sm" type="text" id="text-iv"
                            placeholder="If empty, random 16 bytes will be generated as IV.">
                    </div>
                    <div class="col-sm-2 pt-1">
                        <button class="btn btn-sm btn-pill btn-info btn-block mb-3" id="button-set-iv"
                            type="button">Set IV </button>
                    </div>
                </div>
            </div>
        </div>


        <hr>

        <div class="row">
            <div class="col-sm-6">
                <button class="btn btn-sm btn-pill btn-block btn-primary" id="button-encrypt"
                    type="button">Encrypt</button>
            </div>
            <div class="col-sm-6">
                <button class="btn btn-sm btn-pill btn-block btn-dark" id="button-encrypt-file" type="button">Encrypt
                    File</button>
            </div>
        </div>

        <h6 class="mt-2 mb-2">Encryption Result</h6>
        <textarea class="form-control form-control-sm" id="textarea-enc-result" name="textarea-result"
            rows="2"></textarea>


        <div class="row mt-3">
            <div class="col-sm-6">
                <button class="btn btn-sm btn-pill btn-block btn-primary" id="button-decrypt"
                    type="button">Decrypt</button>
            </div>
            <div class="col-sm-6">
                <button class="btn btn-sm btn-pill btn-block btn-dark" id="button-decrypt-file" type="button">Decrypt
                    File</button>
            </div>
        </div>

        <h6 class="mt-2 mb-2">Decryption Result</h6>
        <textarea class="form-control form-control-sm" id="textarea-dec-result" name="textarea-result"
            rows="2"></textarea>

        <h6 class="mt-4 mb-2">Get Symmetric Key&IV</h6>
        <div class="row">
            <div class="col-sm-6">
                <div class="form-group row">
                    <label class="col-sm-4 col-form-label" for="text-key-name">Key Name</label>
                    <div class="col-sm-8">
                        <input class="form-control form-control-sm" type="text" id="text-key-name"
                            value="test@signgate.com">
                    </div>
                </div>
                <div id="cert-warpper">
                    <label for="textarea-server-cert">Certificate <small>(한정인(개인) signCert.der)</small></label>
                    <textarea class="form-control form-control-sm" id="textarea-server-cert" name="textarea-server-cert"
                        rows="4">MIIFyzCCBLOgAwIBAgIEBOAzejANBgkqhkiG9w0BAQsFADBKMQswCQYDVQQGEwJLUjENMAsGA1UECgwES0lDQTEVMBMGA1UECwwMQWNjcmVkaXRlZENBMRUwEwYDVQQDDAxzaWduR0FURSBDQTUwHhcNMTkwNzA4MDY0NTAwWhcNMjAwNzA4MTQ1OTU5WjCBkjELMAkGA1UEBhMCS1IxDTALBgNVBAoMBEtJQ0ExEzARBgNVBAsMCmxpY2Vuc2VkQ0ExFTATBgNVBAsMDOuTseuhneq4sOq0gDEZMBcGA1UECwwQS0lDQeqzoOqwneyEvO2EsDERMA8GA1UECwwI7IS87YSwUkExGjAYBgNVBAMMEe2VnOygleyduCjqsJzsnbgpMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAiszgCtp4M43q6Ptq4cYoB/jqsY3EXt/LPQGcQzOT4/9nDnLtFoShADNx8i2nUZGCy4dOSexuhDeX0NwTffMK3kNQBc9SkQ5ye/ro8Gzc+v2eI+sGFH4oo/KgG+PIUjG9H5GYsY6de+TEg9+zMmhkeHDAh8I8jc0QTW9btBKxWOgSAF5JBsuL1fPdIUKskoSYH4OY8gu/6yTNMG16qoMJxzW+y2bKvx5jq1Qqf+cHGx1M5vw147BGuHJhLapgI+LoWX04hI6ysPFiyzO9IXuxonpKX3m7oKJMF5Ht2hXEvAl9O6WiUqZDfxpCPPpb8Egnp63CvZOQ/d+8wq4Jy2WZ5QIDAQABo4ICbjCCAmowgY8GA1UdIwSBhzCBhIAU2L467EWZxZ7jnOqBH9IdErA2PoihaKRmMGQxCzAJBgNVBAYTAktSMQ0wCwYDVQQKDARLSVNBMS4wLAYDVQQLDCVLb3JlYSBDZXJ0aWZpY2F0aW9uIEF1dGhvcml0eSBDZW50cmFsMRYwFAYDVQQDDA1LSVNBIFJvb3RDQSA0ggIQHTAdBgNVHQ4EFgQUOJKmGzgbahSwjUQWtdVn8Lcmu00wDgYDVR0PAQH/BAQDAgbAMHUGA1UdIARuMGwwagYKKoMajJpEBQIBAjBcMCwGCCsGAQUFBwIBFiBodHRwOi8vd3d3LnNpZ25nYXRlLmNvbS9jcHMuaHRtbDAsBggrBgEFBQcCAjAgHh7HdAAgx3jJncEcspQAIKz1x3jHeMmdwRzHhbLIsuQwgYgGA1UdEQSBgDB+gRVwdXJlMjcxM0BzaWduZ2F0ZS5jb22gZQYJKoMajJpECgEBoFgwVgwR7ZWc7KCV7J24KOqwnOyduCkwQTA/BgoqgxqMmkQKAQEBMDEwCwYJYIZIAWUDBAIBoCIEIIgrBYVsaT0ERzn12ajpzrTCdgQ4kN4sPHmvpTmUDd89MF8GA1UdHwRYMFYwVKBSoFCGTmxkYXA6Ly9sZGFwLnNpZ25nYXRlLmNvbTozODkvb3U9ZHA3cDE0ODAzLG91PWNybGRwLG91PUFjY3JlZGl0ZWRDQSxvPUtJQ0EsYz1LUjBEBggrBgEFBQcBAQQ4MDYwNAYIKwYBBQUHMAGGKGh0dHA6Ly9vY3NwLnNpZ25nYXRlLmNvbTo5MDIwL09DU1BTZXJ2ZXIwDQYJKoZIhvcNAQELBQADggEBAKKJVYn61+9l/+cAbY12mmLTBRPkBjtIGuCEESIncjgRFBSYCj/fDiACNoj9NpOeuzxqsXZvEXnt8mXsNT5Eg5ZnwWCDLNn4DFfmL0ShETRTeZiIG2taAhAZVxhSAlvRp+fJISnGQgvXqZht2aptoLAxsAcVkp52kHTNN/VAZKwsrbycIMUarG6GIXilzmo7PZ4ljw0cujQteHAk41UflKCh9SrKU5hCqK/d1ndk3fujih4AC3pwYyulWPy3r+UumVXeMxHerj7wgS83XkzxDtlNbE+Z4A1+MiqYC9SPXv6T1EscaCMd+DY/SlF+6CD//2V8YixISzBRy6KB3anGSAg=</textarea>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="row mb-4">
                    <div class="col-sm-8">
                        <select class="form-control form-control-sm text-primary" id="select-function" size="1">
                            <option value="getSymmetricKeyIV">GetSymmetricKeyIV</option>
                            <option value="getSymmetricKey">GetSymmetricKey</option>
                            <option value="getSymmetricKeySelf">GetSymmetricKeySelf</option>
                            <option value="getSymmetricKeyIVSelf">GetSymmetricKeyIVSelf</option>
                        </select>
                    </div>
                    <div class="col-sm-4 pt-1">
                        <button class="btn btn-sm btn-pill btn-block btn-info" id="button-get-key-iv"
                            type="button">Get Key&IV</button>
                    </div>
                </div>

                <label for="textarea-servkey-iv">KEY&IV <small>(Base64 Encoded)</small></label>
                <textarea class="form-control form-control-sm" id="textarea-key-iv" rows="4"></textarea>

            </div>
        </div>
        <!-- /.row-->
    </div>
</div>

<script>
    var func = ""
    $('#button-encrypt').click(function () {
        func = "symmetricEncryptData";
        var cmd = "encResult." + func;
        var algorithm = $("#select-cipher-algorithm").val() + "/" + $("#select-cipher-mode").val() + "/" + $("#select-cipher-padding").val();
        var sourceString = $("#textarea-message").val();
        var keyName = $("#text-key-name").val();
        var param = JSON.stringify({
            'algorithm': algorithm,
            'keyName': keyName,
            'sourceString': sourceString
        });

        secukitnxInterface.SecuKitNXS(cmd, param);
    });

    $('#button-decrypt').click(function () {
        func = "symmetricDecryptData";
        var cmd = "decResult." + func;
        var encryptedString = $("#textarea-enc-result").val();
        var keyName = $("#text-key-name").val();
        var param = JSON.stringify({
            'keyName': keyName,
            'encryptedString': encryptedString
        });

        secukitnxInterface.SecuKitNXS(cmd, param);
    });

    $('#button-encrypt-file').click(function () {
        func = "symmetricEncryptFile";
        var cmd = "encResult." + func;
        var algorithm = $("#select-cipher-algorithm").val() + "/" + $("#select-cipher-mode").val() + "/" + $("#select-cipher-padding").val();
        var sourceFilePath = $("#text-file-path").val();
        var keyName = $("#text-key-name").val();
        var param = JSON.stringify({
            'algorithm': algorithm,
            'keyName': keyName,
            'sourceFilePath': sourceFilePath,

        });

        secukitnxInterface.SecuKitNXS(cmd, param);
    });

    $('#button-decrypt-file').click(function () {
        func = "symmetricDecryptFile";
        var cmd = "decResult." + func;
        var enctyptedFilePath = $("#text-file-path").val().slice(0, -4) + "_symmEnc.txt";
        var keyName = $("#text-key-name").val();
        var param = JSON.stringify({
            'keyName': keyName,
            'enctyptedFilePath': enctyptedFilePath
        });

        secukitnxInterface.SecuKitNXS(cmd, param);
    });

    $('#button-set-iv').click(function () {
        var cmd = "genKeyIV.genSymmetricKey";
        var algorithm = $("#select-cipher-algorithm").val() + "/" + $("#select-cipher-mode").val() + "/" + $("#select-cipher-padding").val();
        var param = JSON.stringify({
            "algorithm": algorithm,
            "IV": "" + $("#text-iv").val(),
            "keyName": $("#text-key-name").val()
        })
        secukitnxInterface.SecuKitNXS(cmd, param);
    })

    $('#button-reset-key').click(function () {
        var keyName = $("#text-key-name").val();
        $("#text-iv").val("");
        NXclearSymmetricKey(keyName);

        alert("Clear Symmetric Key");
    })
    var func;
    $("#button-get-key-iv").click(function () {
        func = $("#select-function").val();
        if (func.indexOf("Self") >= 0) {
            processLogic.init();
            processLogic.setProcessLogic(func);

            NX_ShowDialog();
            return;
        }

        var cmd = func + "." + func;
        var param = JSON.stringify({
            "serverCert": $("#textarea-server-cert").val(),
            "rsaVersion": "V15",
            "keyName": $("#text-key-name").val()
        })

        secukitnxInterface.SecuKitNXS(cmd, param);
    })

    $("#select-function").change(function () {
        func = $(this).val();

        $("#cert-warpper").removeClass("d-none");
        if (func.indexOf("Self") >= 0) {
            $("#cert-warpper").addClass("d-none");
        }

    })

    function SecuKitNXS_RESULT(cmd, res) {
        if (res.ERROR_CODE !== undefined) {
            // Error Message 출력
            $('.nx-cert-select').hide(); $('#nx-pki-ui-wrapper').hide(); KICA_Error.init();
            KICA_Error.setError(res.ERROR_CODE, res.ERROR_MESSAGE);
            var errorMsg = KICA_Error.getError();
            alert(errorMsg);
            return;
        }

        switch (cmd) {
            case 'encResult':
                var result = eval("res." + func);
                $("#textarea-enc-result").val(result);

                break;

            case 'decResult':
                var result = eval("res." + func);
                $("#textarea-dec-result").val(result);

                break;

            case 'genKeyIV':
                var iv = $("#text-iv").val();
                if (iv === "") {
                    iv = "0123456789012345";
                }
                alert("IV has been set to '" + iv + "'.");
                break;

            case func:
                if (cmd.indexOf("Self") >= 0) {
                    var cmd = "getSymKeyRsult." + func;
                    var param = JSON.stringify({
                        "certType": "SignCert",
                        "certID": res,
                        "rsaVersion": "V15",
                        "keyName": $("#text-key-name").val()
                    })
                    secukitnxInterface.SecuKitNXS(cmd, param);
                    return;
                }
                var result = eval("res." + func);
                $("#textarea-key-iv").val(result);

                break;

            case "getSymKeyRsult":
                var result = eval("res." + func);
                $("#textarea-key-iv").val(result);
                break;
            default: break;
        }
    }
</script>